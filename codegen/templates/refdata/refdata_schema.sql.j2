{#
  // codegen-metadata
  // output_path: infra/clickhouse/refdata_dbschema.sql
#}
-- THIS FILE IS AUTO-GENERATED BY THE CODE-GEN SCRIPT. DO NOT EDIT.
-- Contains table creation scripts for Reference Data entities.

{% for entity in entities %}

-- Schema for {{ entity.name }}
CREATE TABLE IF NOT EXISTS RefData.{{ entity.table_name }}
(
    {# Loop through the members to create columns #}
    {% for member in entity.members %}
    {% set CHType = "LowCardinality(String)" if "LowCardinality(String)" in member.clickhouse_modifier else types[member.type].clickhouse %}
    `{{ member.name | capitalise_first }}` {{ CHType }} {% if member.comment %}COMMENT '{{ member.comment | e }}'{% endif %},
    {% endfor %}
    `_IsActive` UInt8 COMMENT 'Boolean flag (1=Active, 0=Inactive)',
    `_LastUpdatedTs` Datetime64(6) DEFAULT now64(6) COMMENT 'Timestamp of the last update to this record',
    `_LastUpdatedBy` String COMMENT 'User or system that last updated this record'
)
ENGINE = MergeTree
ORDER BY ({{ entity.key | capitalise_first }}, _LastUpdatedTs)
{% if entity.comment %}
COMMENT '{{ entity.comment | e }}';
{% endif %}

{% endfor %}