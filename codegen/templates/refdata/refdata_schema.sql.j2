{#
  // codegen-metadata
  // output_path: infra/clickhouse/refdata_dbschema.sql
#}
-- THIS FILE IS AUTO-GENERATED BY THE CODE-GEN SCRIPT. DO NOT EDIT.
-- Contains table creation scripts for Reference Data entities.

CREATE DATABASE RefData;

{% for entity in entities %}
-- Schema for {{ entity.name }}
CREATE TABLE IF NOT EXISTS RefData.{{ entity.table_name }}
(
    `UUID` UUID COMMENT 'The immutable, globally unique system identifier (Machine Key)',
    {# Loop through the members to create columns #}
    {% for member in entity.members %}
    {% set CHType = "LowCardinality(String)" if "LowCardinality(String)" in member.clickhouse_modifier else types[member.type].clickhouse %}
    `{{ member.name | capitalise_first }}` {{ CHType }} {% if member.comment %}COMMENT '{{ member.comment | e }}'{% endif %},
    {% endfor %}
    `_IsActive` UInt8 COMMENT 'Boolean flag (1=Active, 0=Inactive)',
    `_LastUpdatedTs` DateTime64(6) DEFAULT now64(6) COMMENT 'Timestamp of the last update to this record',
    `_LastUpdatedBy` String COMMENT 'User or system that last updated this record',
    `_Version` UInt32 DEFAULT 0 COMMENT 'Version number for optimistic concurrency control'
)
ENGINE = MergeTree
ORDER BY (UUID, _LastUpdatedTs)
PRIMARY KEY (UUID)
{% if entity.comment %}
COMMENT '{{ entity.comment | e }}';
{% endif %}

{% endfor %}