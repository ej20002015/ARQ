{#
  // codegen-metadata
  // output_path: ARQLib/ARQCore/inc/refdata_commands.h
#}
// THIS FILE IS AUTO-GENERATED BY THE CODE-GEN SCRIPT. DO NOT EDIT.
// Contains C++ definitions for Reference Data commands.

#pragma once

#include <ARQUtils/id.h>
#include <ARQCore/refdata_entities.h>

namespace ARQ::RD::Cmd
{

ARQ_DEFINE_TYPE_CATEGORY( Command );

template<c_Command T>
struct Traits;

// -------------------- Upsert Command --------------------

/// Represents a request to insert or update a Reference Data record
template<c_RefData T>
struct Upsert
{
    /// The unique system ID (Machine Key) of the record to create or update
    ID::UUID    targetUUID;
    /// The new state of the business data
    T           data;
    /// The ID of the actor or system performing this update
    std::string updatedBy;
    /// The expected version for optimistic concurrency control (0 for new records)
    uint32_t    expectedVersion;
};

{% for entity in entities %}
ARQ_REG_CATEGORY( Command, Upsert<{{ entity.name }}> )
{% endfor %}

template<c_RefData T>
struct Traits<Upsert<T>>
{
    using EntityType = T;

    static std::string_view name()
    {
        static std::string nameStr = std::string( "Upsert<" ) + std::string( RD::Traits<T>::name() ) + ">";
        return nameStr;
    }

	static constexpr std::string_view action()                       { return "Upsert"; }
	static constexpr std::string_view entity()                       { return RD::Traits<T>::name(); }
	static           ID::UUID         getKey( const Upsert<T>& cmd ) { return cmd.targetUUID; }
};

// -------------------- Deactivate Command --------------------

/// Represents a request to soft-delete (tombstone) a Reference Data record
template<c_RefData T>
struct Deactivate
{
    /// The unique system ID (Machine Key) of the record to deactivate
    ID::UUID    targetUUID;
    /// The ID of the actor or system performing this deactivation
    std::string updatedBy;
    /// The expected version for optimistic concurrency control
    uint32_t    expectedVersion;
};

{% for entity in entities %}
ARQ_REG_CATEGORY( Command, Deactivate<{{ entity.name }}> )
{% endfor %}

template<c_RefData T>
struct Traits<Deactivate<T>>
{
    using EntityType = T;

    static std::string_view name()
    {
        static std::string nameStr = std::string( "Deactivate<" ) + std::string( RD::Traits<T>::name() ) + ">";
        return nameStr;
    }

    static constexpr std::string_view action()                           { return "Deactivate"; }
    static constexpr std::string_view entity()                           { return RD::Traits<T>::name(); }
    static           ID::UUID         getKey( const Deactivate<T>& cmd ) { return cmd.targetUUID; }
};

}

{% for entity in entities %}
ARQ_REG_TYPE( ARQ::RD::Cmd::Upsert<ARQ::RD::{{ entity.name }}> );
ARQ_REG_TYPE( ARQ::RD::Cmd::Deactivate<ARQ::RD::{{ entity.name }}> );
{% endfor %}